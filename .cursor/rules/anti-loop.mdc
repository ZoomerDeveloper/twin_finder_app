---
description: Prevent loops & runaway retries for any task
globs:
  - "**/*"
alwaysApply: true
---

# Anti-loop guard (global)
- Веди журнал в `./docs/agent_state.md`: добавляй строку на каждый шаг (Шаг → Команда/Правка → Ожидание → Факт.результат).
- Перед НОВЫМ действием ПРОЧИТАЙ журнал. Не повторяй одно и то же действие/команду, если не появилось НОВОЕ основание (изменение кода/флагов/окружения/зависимостей).
- Лимит попыток: максимум 3 попытки на один и тот же шаг. Если 2 раза подряд получена одинаковая ошибка или нулевой эффект — ОСТАНОВИСЬ и спроси пользователя, что менять.
- Всегда работай в цикле PLAN → ACT:
  - PLAN: распиши шаги, критерий «Готово» (Done), риск-факторы и план отката.
  - ACT: выполняй ТОЛЬКО первый шаг из плана, затем пересмотри план.
- Перед запуском терминальной команды опиши условие успеха/провала и что изменится при повторном запуске. Без изменения параметров — не перезапускай.